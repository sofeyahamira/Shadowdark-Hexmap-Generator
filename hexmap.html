<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadowdark Hex Map Generator</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --accent-color: #d4af37; /* Gold-ish */
            --panel-bg: #2b2b2b;
            --hex-size: 100px;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: var(--accent-color);
            text-transform: uppercase;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }

        .controls {
            margin-bottom: 20px;
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
        }

        button {
            background-color: var(--accent-color);
            color: #000;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            font-family: inherit;
        }

        button:hover {
            opacity: 0.9;
        }

        input {
            padding: 10px;
            background: #000;
            border: 1px solid #555;
            color: #fff;
            width: 60px;
            font-family: inherit;
        }

        /* HEX GRID STYLES */
        .hex-container {
            display: flex;
            flex-wrap: wrap;
            width: 90%;
            justify-content: center;
            margin-bottom: 40px;
            gap: 10px; /* Gap between hex items strictly for flex flow */
        }

        .hex {
            width: var(--hex-size);
            height: calc(var(--hex-size) * 0.866); /* Hex height ratio */
            background-color: #555;
            position: relative;
            clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            text-align: center;
            color: #000;
            font-weight: bold;
            transition: transform 0.2s;
            margin-right: -15px; /* Overlap for honeycomb look */
            margin-bottom: -10px;
        }

        .hex:hover {
            transform: scale(1.1);
            z-index: 10;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .hex-id {
            font-size: 1.2em;
            margin-bottom: 2px;
        }

        .hex-icon {
            font-size: 1.5em;
        }

        .has-poi::after {
            content: "!";
            position: absolute;
            top: 5px;
            right: 25px;
            color: red;
            font-weight: 900;
            font-size: 1.2em;
        }

        /* TERRAIN COLORS */
        .t-desert-arctic { background-color: #d8d8d8; }
        .t-swamp { background-color: #4a5d23; color: #fff; }
        .t-grassland { background-color: #7cfc00; }
        .t-forest-jungle { background-color: #006400; color: #fff;}
        .t-river-coast { background-color: #4682b4; color: #fff;}
        .t-ocean { background-color: #000080; color: #fff;}
        .t-mountain { background-color: #696969; color: #fff; }

        /* OUTPUT LOG */
        .output-log {
            width: 80%;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 5px;
            white-space: pre-wrap;
            border: 1px solid #444;
            max-height: 500px;
            overflow-y: auto;
        }

        .log-entry {
            border-bottom: 1px dashed #555;
            padding: 10px 0;
        }
        .log-entry:last-child { border-bottom: none; }
        
        .poi-text { color: #ff6b6b; font-weight: bold; }
        .danger-safe { color: #55efc4; }
        .danger-unsafe { color: #ffeaa7; }
        .danger-risky { color: #ff7675; }
        .danger-deadly { color: #d63031; font-weight: bold;}

    </style>
</head>
<body>

    <h1>Shadowdark Mapper</h1>
    
    <div class="controls">
        <label>Number of Hexes: <input type="number" id="hexCount" value="10" min="1" max="100"></label>
        <button onclick="generateMap()">Generate Map</button>
    </div>

    <div class="hex-container" id="hexGrid">
        </div>

    <div class="output-log" id="textLog">
        </div>

<script>
    // --- DATA TABLES ---

    const TERRAINS = [
        { name: "Desert/Arctic", colorClass: "t-desert-arctic", icon: "â„ï¸/â˜€ï¸" }, // Index 0
        { name: "Swamp", colorClass: "t-swamp", icon: "ðŸŠ" },           // Index 1
        { name: "Grassland", colorClass: "t-grassland", icon: "ðŸŒ¾" },       // Index 2
        { name: "Forest/Jungle", colorClass: "t-forest-jungle", icon: "ðŸŒ²" },   // Index 3
        { name: "River/Coast", colorClass: "t-river-coast", icon: "ðŸŒŠ" },     // Index 4
        { name: "Ocean", colorClass: "t-ocean", icon: "â›µ" },           // Index 5
        { name: "Mountain", colorClass: "t-mountain", icon: "â›°ï¸" }        // Index 6
    ];

    const DANGER_LEVELS = [
        { roll: 1, label: "Safe", class: "danger-safe" },
        { roll: 3, label: "Unsafe", class: "danger-unsafe" }, // 2-3
        { roll: 5, label: "Risky", class: "danger-risky" },   // 4-5
        { roll: 6, label: "Deadly", class: "danger-deadly" }  // 6
    ];

    const CATACLYSMS = [
        "Volcano", "Fire", "Earthquake", "Storm", "Flood", "War", "Pestilence", "Magical disaster"
    ];

    const SETTLEMENT_NAMES = [
        { village: "Bruga's Hold", town: "Fairhollow", city: "Doraine" },
        { village: "Lastwatch", town: "Ivan's Keep", city: "Meridia" },
        { village: "Darkwater", town: "Galina", city: "King's Gate" },
        { village: "Ostlin", town: "Brightlantern", city: "Myrkhos" },
        { village: "Treefall", town: "Corvin's Crest", city: "Rularn" },
        { village: "Vorn", town: "Ironbridge", city: "Ordos" },
        { village: "Hillshire", town: "Skalvin", city: "Thane" },
        { village: "Nighthaven", town: "Toresk", city: "Rahgbat" }
    ];

    const POI_TABLE = [
        { label: "Small tower", dev: "Disaster! Roll on Cataclysm table" }, // 1
        { label: "Fortified keep", dev: "Over/connected to a large tomb" }, // 2
        { label: "Natural landmark", dev: "Being attacked by an invader" }, // 3-4
        { label: "Natural landmark", dev: "Being attacked by an invader" },
        { label: "Temple", dev: "Home to an oracle" }, // 5
        { label: "Barrow mounds", dev: "Around/over a sleeping dragon" }, // 6
        { label: "Village", dev: "Abandoned and in ruins" }, // 7-8
        { label: "Village", dev: "Abandoned and in ruins" },
        { label: "Town", dev: "Guarded by its current residents" }, // 9-10
        { label: "Town", dev: "Guarded by its current residents" },
        { label: "City/metropolis", dev: "Under siege by a warband" }, // 11
        { label: "Ravine", dev: "Home to a religious cult" }, // 12
        { label: "Monster nest", dev: "Where a secret circle of wizards meets" }, // 13-14
        { label: "Monster nest", dev: "Where a secret circle of wizards meets" },
        { label: "Hermit's abode", dev: "Occupied by a self-titled king/queen" }, // 15
        { label: "Cave formation", dev: "Controlled by a malevolent sorcerer" }, // 16-17
        { label: "Cave formation", dev: "Controlled by a malevolent sorcerer" },
        { label: "Ancient dolmens", dev: "Protected by an age-old guardian" }, // 18
        { label: "Barbarian camp", dev: "Hiding a great treasure" }, // 19
        { label: "Holy shrine", dev: "With a door to another plane" } // 20
    ];

    // --- HELPER FUNCTIONS ---

    function rollDie(sides) {
        return Math.floor(Math.random() * sides) + 1;
    }

    function roll2d6() {
        return rollDie(6) + rollDie(6);
    }

    function getTerrainFromRoll(roll) {
        // Based on Hex Terrain Table (p. 132)
        if (roll === 2) return 0; // Desert/Arctic
        if (roll === 3) return 1; // Swamp
        if (roll >= 4 && roll <= 6) return 2; // Grassland
        if (roll >= 7 && roll <= 8) return 3; // Forest/Jungle
        if (roll >= 9 && roll <= 10) return 4; // River/Coast
        if (roll === 11) return 5; // Ocean
        if (roll === 12) return 6; // Mountain
        return 2; // Default to grassland if something breaks
    }

    function getDangerLevel() {
        let r = rollDie(6);
        if (r === 1) return DANGER_LEVELS[0];
        if (r <= 3) return DANGER_LEVELS[1];
        if (r <= 5) return DANGER_LEVELS[2];
        return DANGER_LEVELS[3];
    }

    function generatePOI() {
        // Roll d6, on a 1 there is a POI
        if (rollDie(6) !== 1) return null;

        const roll = rollDie(20);
        // Array is 0-indexed, so we use roll-1
        let poiBase = POI_TABLE[roll - 1];
        let result = {
            name: poiBase.label,
            details: poiBase.dev,
            roll: roll
        };

        // Handle Special Cases
        // 1. Cataclysm (Roll 1)
        if (roll === 1) {
            const catRoll = rollDie(8);
            result.details = `Disaster! (${CATACLYSMS[catRoll - 1]})`;
        }
        
        // 2. Settlement Names (Village 7-8, Town 9-10, City 11)
        if (roll >= 7 && roll <= 11) {
            const nameRoll = rollDie(8);
            let name = "";
            let type = "";
            
            if (roll <= 8) { // Village
                name = SETTLEMENT_NAMES[nameRoll-1].village;
                type = "Village";
            } else if (roll <= 10) { // Town
                name = SETTLEMENT_NAMES[nameRoll-1].town;
                type = "Town";
            } else { // City
                name = SETTLEMENT_NAMES[nameRoll-1].city;
                type = "City/Metropolis";
            }
            result.name = `${type}: ${name}`;
        }

        return result;
    }

    // --- MAIN LOGIC ---

    function generateMap() {
        const count = document.getElementById('hexCount').value;
        const grid = document.getElementById('hexGrid');
        const log = document.getElementById('textLog');
        
        grid.innerHTML = "";
        log.innerHTML = "<h3>Generated Path</h3>";

        let currentTerrainIndex = getTerrainFromRoll(roll2d6()); // Initial starting terrain

        for (let i = 1; i <= count; i++) {
            
            // 1. Determine Terrain (Logic: Move into empty hex -> Roll New Hex table)
            // If it's the first hex, we just use the initial roll. 
            // If it's subsequent, we apply the "New Hex" logic to the PREVIOUS terrain.
            
            if (i > 1) {
                let newHexRoll = roll2d6();
                
                // Logic from "New Hex" Table
                if (newHexRoll >= 2 && newHexRoll <= 3) {
                    // Current + 1 step
                    currentTerrainIndex = (currentTerrainIndex + 1) % 7;
                } else if (newHexRoll >= 9 && newHexRoll <= 11) {
                    // Current + 2 steps
                    currentTerrainIndex = (currentTerrainIndex + 2) % 7;
                } else if (newHexRoll === 12) {
                    // Roll new fresh terrain
                    currentTerrainIndex = getTerrainFromRoll(roll2d6());
                } 
                // 4-8 is "Same as current", so no change.
            }

            const terrainObj = TERRAINS[currentTerrainIndex];

            // 2. Determine Danger
            const danger = getDangerLevel();

            // 3. Determine POI
            const poi = generatePOI();

            // --- RENDER HEX ---
            const hexDiv = document.createElement('div');
            hexDiv.className = `hex ${terrainObj.colorClass}`;
            if (poi) hexDiv.classList.add('has-poi');
            
            hexDiv.innerHTML = `
                <span class="hex-id">#${i}</span>
                <span class="hex-icon">${terrainObj.icon}</span>
            `;
            hexDiv.title = `${terrainObj.name}\nDanger: ${danger.label}\nPOI: ${poi ? poi.name : 'None'}`;
            
            // Click to see details in alert (optional UX)
            hexDiv.onclick = () => {
                alert(`Hex #${i}\nTerrain: ${terrainObj.name}\nDanger: ${danger.label}\nPOI: ${poi ? poi.name + ' - ' + poi.details : 'None'}`);
            };

            grid.appendChild(hexDiv);

            // --- RENDER TEXT LOG ---
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            let poiString = "None";
            if (poi) {
                poiString = `<span class="poi-text">${poi.name}</span> <br> &nbsp;&nbsp; -> ${poi.details}`;
            }

            entry.innerHTML = `
                <strong>Hex:</strong> ${i} <br>
                <strong>Terrain:</strong> ${terrainObj.name} <br>
                <strong>Danger Level:</strong> <span class="${danger.class}">${danger.label}</span> <br>
                <strong>POI:</strong> ${poiString}
            `;
            log.appendChild(entry);
        }
    }

    // Generate one on load
    window.onload = generateMap;

</script>

</body>
</html>
